# Pipelines

The pipelines are orchestrated using [DVC](https://dvc.org).

## Current dependency graph

[![](https://mermaid.ink/img/pako:eNqNlE1TwjAQhv8KkzNRAojQg-PBo170pvWwJFvIkI9OmsIwDv_dAi3SJgg9tW_6bN_d7u4P4VYgSUim7IYvwfne63tqevVlqkP2lZJc5qikweJerPndFrRK-BL5imbW0RwWSMtcgMciJd9tetiiuQKpwfizOLmzHIuCno6CEKO4AWO1LKiwG6MsiJCi9OlgoC2P48E2TnqkGj1UaUAQ7KFFWXNGNgaelQ6tT27gtB6OAvDxBrA0qANwehmsKx01OruORX2ywXUw6vOh_j3TTsFqedYpRy2zQSfbWh93sonLbHBBb7c4R1OUkYLT40FYg-G_-KnBL9Csya3Tqazd9wrmtnRUg1uhj5jLnNX0MBPhJ8a3RGp8qv0cezrf0pxbEwZrBot1q9gekjVwMFxipJBhzMk1tDYXkk0fsQnpE41OgxTVOvvZv5YSv0SNKUmqW4EZlMqnJDW76lUovf3YGk4S70rsk-P-epGwcKBJkoEqKjUH82nt3zMK6a17O67Mw-bc_QIohri9?type=png)](https://mermaid.live/edit#pako:eNqNlE1TwjAQhv8KkzNRAojQg-PBo170pvWwJFvIkI9OmsIwDv_dAi3SJgg9tW_6bN_d7u4P4VYgSUim7IYvwfne63tqevVlqkP2lZJc5qikweJerPndFrRK-BL5imbW0RwWSMtcgMciJd9tetiiuQKpwfizOLmzHIuCno6CEKO4AWO1LKiwG6MsiJCi9OlgoC2P48E2TnqkGj1UaUAQ7KFFWXNGNgaelQ6tT27gtB6OAvDxBrA0qANwehmsKx01OruORX2ywXUw6vOh_j3TTsFqedYpRy2zQSfbWh93sonLbHBBb7c4R1OUkYLT40FYg-G_-KnBL9Csya3Tqazd9wrmtnRUg1uhj5jLnNX0MBPhJ8a3RGp8qv0cezrf0pxbEwZrBot1q9gekjVwMFxipJBhzMk1tDYXkk0fsQnpE41OgxTVOvvZv5YSv0SNKUmqW4EZlMqnJDW76lUovf3YGk4S70rsk-P-epGwcKBJkoEqKjUH82nt3zMK6a17O67Mw-bc_QIohri9)

> This has been generated by running `dvc dag --mermaid` and copying the result
> into https://mermaid.live/. _NB_ changing the flowchart direction from `TD` to
> `LR` seems to render a better chart.

## Pipeline automation

These are automated by the
[`pipeline` GitHub action](../.github/workflows/pipeline.yml).

It is currently scheduled to run every weekday at 06:20, 07:20, 08:20 and 09:20,
using the cron string [20 6-9 * * 1-5](https://crontab.guru/#20_6-9_*_*_1-5). It
can also be triggered manually on the
[`pipeline` page on GitHub](https://github.com/open-innovations/yff-data-pipelines/actions/workflows/pipeline.yml).

## Outbound triggers

The `changes` step in the [pipeline GitHub action](../.github/workflows/pipeline.yml)
uses a call to `git status` to watch
for any changes in `data/processed` and `data/metadata` and uses a GitHub
Repository Dispatch trigger to cause the
[Update data action](https://github.com/open-innovations/yff-data/actions/workflows/update-data.yml)
to run on the YFF Data site repository. This means that as the data changes in
this repository, it will immediately start a build in the data pipeline, which
will in turn trigger a build in the site.

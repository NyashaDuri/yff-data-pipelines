# Pipelines

The pipelines are orchestrated using [DVC](https://dvc.org).

## Current dependency graph

[![](https://mermaid.ink/img/pako:eNqNlE1TgzAQhv-Kk7NRA1aUg-PBo170pnhYw9Jmmg8mCe10Ov53aQtTIcGWE7zJs7ts8u6WcFMiyUklzZovwPqLl7dCX3SPbhfZZ0FqUaMUGt11ueJXG1Ay5wvkS1oZS2uYI23qEjy6gnwN6WRAc9Su-ROktoajc_SgB3A6hCUIBdrH-H4pCHEbr14bJRwtzVpLA2VIUfq4rz4up0N5Fs-xtsIjVeihbQ0EOe4GlEb0R3SysOwfqGtGwNwPGKNdmOdJqpB7OINTKkkDkN2cQTYaVUiyabL7vWipLDnNxUtNT4PRSu-6q5CNzqeTZ6Mj6GTGRi3u9WTcwX4hHTconoAlE3o6oQ99IeHbNJYqsMvYNaSVNYruPRN2cHZOpN6ocjckPP3e0JobHQbrHcbG9Q7dsgIOmgt0Z1iGZafQKeOw_pBZRi6JQqtAlO2s3O62FcQvUGFB8va1xAoa6QtS6J92KzTevG80J7m3DV6Sw3B8FjC3oEhegXStWoP-MOb4jaXwxr4e5vF-LP_8Attv040?type=png)](https://mermaid.live/edit#pako:eNqNlE1TgzAQhv-Kk7NRA1aUg-PBo170pnhYw9Jmmg8mCe10Ov53aQtTIcGWE7zJs7ts8u6WcFMiyUklzZovwPqLl7dCX3SPbhfZZ0FqUaMUGt11ueJXG1Ay5wvkS1oZS2uYI23qEjy6gnwN6WRAc9Su-ROktoajc_SgB3A6hCUIBdrH-H4pCHEbr14bJRwtzVpLA2VIUfq4rz4up0N5Fs-xtsIjVeihbQ0EOe4GlEb0R3SysOwfqGtGwNwPGKNdmOdJqpB7OINTKkkDkN2cQTYaVUiyabL7vWipLDnNxUtNT4PRSu-6q5CNzqeTZ6Mj6GTGRi3u9WTcwX4hHTconoAlE3o6oQ99IeHbNJYqsMvYNaSVNYruPRN2cHZOpN6ocjckPP3e0JobHQbrHcbG9Q7dsgIOmgt0Z1iGZafQKeOw_pBZRi6JQqtAlO2s3O62FcQvUGFB8va1xAoa6QtS6J92KzTevG80J7m3DV6Sw3B8FjC3oEhegXStWoP-MOb4jaXwxr4e5vF-LP_8Attv040)

> This has been generated by running `dvc dag --mermaid` and copying the result
> into https://mermaid.live/. _NB_ changing the flowchart direction from `TD` to
> `LR` seems to render a better chart.

## Pipeline automation

These are automated by the
[`pipeline` GitHub action](../.github/workflows/pipeline.yml).

It is currently scheduled to run every weekday at 06:20, 07:20, 08:20 and 09:20,
using the cron string [20 6-9 * * 1-5](https://crontab.guru/#20_6-9_*_*_1-5). It
can also be triggered manually on the
[`pipeline` page on GitHub](https://github.com/open-innovations/yff-data-pipelines/actions/workflows/pipeline.yml).

## Outbound triggers

The `changes` step in the
[pipeline GitHub action](../.github/workflows/pipeline.yml) uses a call to
`git status` to watch for any changes in `data/processed` and `data/metadata`
and uses a GitHub Repository Dispatch trigger to cause the
[Update data action](https://github.com/open-innovations/yff-data/actions/workflows/update-data.yml)
to run on the YFF Data site repository. This means that as the data changes in
this repository, it will immediately start a build in the data pipeline, which
will in turn trigger a build in the site.

# Pipelines

The pipelines are orchestrated using [DVC](https://dvc.org).

## Current dependency graph

[![](https://mermaid.ink/img/pako:eNqNlE1vwjAMhv8KynnZCF3Z6GHaYcftst227mASFyLyUaUpCCH--wq0Gm2CoKf0TR7HdmzvCLcCSUYKZTd8Cc6P3j9zM2o_02yyn5yUskQlDVYPYs3vt6BVxpfIV7SwjpawQFqXAjxWOfnt05MezdFU9ZmR0lmOVUVPegAnfViB1GB8jO-2AhOPce-N1bKiwm6MsiBCitKXo_dxOenLafyOjZMeqUYPTWoguGPao6w5Izu_XpUOI3q6gdN6kgTg8w1gbVAH4Owy2D5A1FE2vs5FHWXsOhh1dNq-z2yQsVZm40FCOp0N4m31dBjPBZ1d0Pu1r2Bua0c1uBX6MPW0cFbTY12GCUlusdQ1gzo0oqfzLS25NaGxSRf2oIxZv1fWwMFwiZEyCW2m19DWuZDseoql5I5odBqkaObR7nAsJ36JGnOSNUuBBdTK5yQ3--Yo1N5-bQ0nmXc13pHTAHqTsHCgSVaAqhq1BPNt7f8_Cumt-zjNvOPo2_8BM0ijBQ?type=png)](https://mermaid.live/edit#pako:eNqNlE1vwjAMhv8KynnZCF3Z6GHaYcftst227mASFyLyUaUpCCH--wq0Gm2CoKf0TR7HdmzvCLcCSUYKZTd8Cc6P3j9zM2o_02yyn5yUskQlDVYPYs3vt6BVxpfIV7SwjpawQFqXAjxWOfnt05MezdFU9ZmR0lmOVUVPegAnfViB1GB8jO-2AhOPce-N1bKiwm6MsiBCitKXo_dxOenLafyOjZMeqUYPTWoguGPao6w5Izu_XpUOI3q6gdN6kgTg8w1gbVAH4Owy2D5A1FE2vs5FHWXsOhh1dNq-z2yQsVZm40FCOp0N4m31dBjPBZ1d0Pu1r2Bua0c1uBX6MPW0cFbTY12GCUlusdQ1gzo0oqfzLS25NaGxSRf2oIxZv1fWwMFwiZEyCW2m19DWuZDseoql5I5odBqkaObR7nAsJ36JGnOSNUuBBdTK5yQ3--Yo1N5-bQ0nmXc13pHTAHqTsHCgSVaAqhq1BPNt7f8_Cumt-zjNvOPo2_8BM0ijBQ)

> This has been generated by running `dvc dag --mermaid` and copying the result
> into https://mermaid.live/. _NB_ changing the flowchart direction from `TD` to
> `LR` seems to render a better chart.

## Pipeline automation

These are automated by the
[`pipeline` GitHub action](../.github/workflows/pipeline.yml).

It is currently scheduled to run every weekday at 06:20, 07:20, 08:20 and 09:20,
using the cron string [20 6-9 * * 1-5](https://crontab.guru/#20_6-9_*_*_1-5). It
can also be triggered manually on the
[`pipeline` page on GitHub](https://github.com/open-innovations/yff-data-pipelines/actions/workflows/pipeline.yml).

## Outbound triggers

The `changes` step in the [pipeline GitHub action](../.github/workflows/pipeline.yml)
uses a call to `git status` to watch
for any changes in `data/processed` and `data/metadata` and uses a GitHub
Repository Dispatch trigger to cause the
[Update data action](https://github.com/open-innovations/yff-data/actions/workflows/update-data.yml)
to run on the YFF Data site repository. This means that as the data changes in
this repository, it will immediately start a build in the data pipeline, which
will in turn trigger a build in the site.

vars:
  - top: ../..
stages:
  download-from-nomis:
    cmd: python download-from-nomis-api.py
    deps:
      - download-from-nomis-api.py
    outs:
      - ${top}/data/raw/lfs_by_pcon.csv:
          cache: false
  download-latest-monthly:
    cmd: papermill --no-progress-bar --no-report-mode get-latest-monthly-files.ipynb  ${top}/output/labour-market-latest-monthly-files.ipynb
    deps:
      - get-latest-monthly-files.ipynb
    outs:
      - ${top}/data/raw/a06-latest.xls:
          cache: false
          persist: false
      - ${top}/data/raw/unem01-latest.xls:
          cache: false
          persist: false
  process-latest-by-pcon:
    cmd: papermill --no-progress-bar --no-report-mode latest-by-pcon.ipynb ${top}/output/labour-market-latest-by-pcon.ipynb
    deps:
      - latest-by-pcon.ipynb
      - ${top}/data/raw/lfs_by_pcon.csv
    outs:
      - ${top}/data/processed/labour-market/most_recent_by_pcon_2010.csv:
          cache: false
          persist: false
  process-latest-a06:
    cmd: papermill --no-progress-bar --no-report-mode process-a06.ipynb ${top}/output/labour-market-a06.ipynb
    deps:
      - process-a06.ipynb
      - ${top}/data/raw/a06-latest.xls
      - ../control.csv
    outs:
      - ${top}/data/processed/labour-market/a06.csv:
          cache: false
          persist: true
      - ${top}/data/metadata/labour-market/a06-codes.csv:
          cache: false
          persist: true

  process-latest-unem01:
    cmd: papermill --no-progress-bar --no-report-mode process-unem01.ipynb ${top}/output/labour-market-unem01.ipynb
    deps:
      - process-unem01.ipynb
      - ${top}/data/raw/unem01-latest.xls
      - ../control.csv
    outs:
      - ${top}/data/processed/labour-market/unem01.csv:
          cache: false
          persist: true
      - ${top}/data/metadata/labour-market/unem01-codes.csv:
          cache: false
          persist: true